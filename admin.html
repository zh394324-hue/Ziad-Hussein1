<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - مطعم الشيف</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { font-family: 'Cairo', sans-serif; }
        .sidebar { transition: width 0.3s; }
        .stat-card { transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .order-card { transition: all 0.3s; }
        .order-card:hover { box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .status-جديد { background: #fef3c7; color: #92400e; }
        .status-قيد_التحضير { background: #dbeafe; color: #1e40af; }
        .status-جاهز { background: #d1fae5; color: #065f46; }
        .status-تم_التوصيل { background: #e5e7eb; color: #374151; }
        .status-ملغي { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar fixed right-0 top-0 h-full w-64 bg-gray-900 text-white z-50">
        <div class="p-6 border-b border-gray-700">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-utensils text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold">مطعم الشيف</h1>
                    <p class="text-xs text-gray-400">لوحة التحكم</p>
                </div>
            </div>
        </div>
        <nav class="p-4">
            <ul class="space-y-2">
                <li>
                    <button onclick="showSection('dashboard')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl bg-orange-500 text-white transition">
                        <i class="fas fa-chart-pie"></i> الرئيسية
                    </button>
                </li>
                <li>
                    <button onclick="showSection('orders')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-800 transition">
                        <i class="fas fa-clipboard-list"></i> الطلبات
                    </button>
                </li>
                <li>
                    <button onclick="showSection('menu')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-800 transition">
                        <i class="fas fa-hamburger"></i> قائمة الطعام
                    </button>
                </li>
                <li>
                    <button onclick="showSection('settings')" class="nav-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gray-800 transition">
                        <i class="fas fa-cog"></i> الإعدادات
                    </button>
                </li>
            </ul>
        </nav>
        <div class="absolute bottom-0 w-full p-4 border-t border-gray-700">
            <a href="index.html" class="flex items-center gap-3 px-4 py-3 text-gray-400 hover:text-white transition">
                <i class="fas fa-store"></i> زيارة المتجر
            </a>
            <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 text-red-400 hover:text-red-300 transition">
                <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="mr-64 min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm px-8 py-4 flex justify-between items-center sticky top-0 z-40">
            <div>
                <h2 id="pageTitle" class="text-2xl font-bold text-gray-800">لوحة التحكم</h2>
                <p class="text-gray-500 text-sm">مرحباً بك في نظام إدارة المطعم</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="relative">
                    <button onclick="toggleNotifications()" class="relative p-2 text-gray-500 hover:text-orange-500 transition">
                        <i class="fas fa-bell text-xl"></i>
                        <span id="notifBadge" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hidden">0</span>
                    </button>
                    <div id="notifDropdown" class="hidden absolute left-0 mt-2 w-80 bg-white rounded-xl shadow-2xl border">
                        <div class="p-4 border-b">
                            <h3 class="font-bold text-gray-800">الإشعارات</h3>
                        </div>
                        <div id="notifList" class="max-h-80 overflow-y-auto">
                            <!-- Notifications will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section id="dashboardSection" class="section p-8 fade-in">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="stat-card bg-white rounded-2xl p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-14 h-14 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-clipboard-list text-blue-600 text-2xl"></i>
                        </div>
                        <span class="text-green-500 text-sm font-semibold"><i class="fas fa-arrow-up"></i> 12%</span>
                    </div>
                    <h3 id="totalOrders" class="text-3xl font-bold text-gray-800">0</h3>
                    <p class="text-gray-500">إجمالي الطلبات</p>
                </div>
                <div class="stat-card bg-white rounded-2xl p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-14 h-14 bg-green-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-money-bill-wave text-green-600 text-2xl"></i>
                        </div>
                        <span class="text-green-500 text-sm font-semibold"><i class="fas fa-arrow-up"></i> 8%</span>
                    </div>
                    <h3 id="totalRevenue" class="text-3xl font-bold text-gray-800">0 ر.س</h3>
                    <p class="text-gray-500">إجمالي الإيرادات</p>
                </div>
                <div class="stat-card bg-white rounded-2xl p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-14 h-14 bg-orange-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-clock text-orange-600 text-2xl"></i>
                        </div>
                    </div>
                    <h3 id="pendingOrders" class="text-3xl font-bold text-gray-800">0</h3>
                    <p class="text-gray-500">طلبات قيد الانتظار</p>
                </div>
                <div class="stat-card bg-white rounded-2xl p-6 shadow-sm">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-14 h-14 bg-purple-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-check-circle text-purple-600 text-2xl"></i>
                        </div>
                    </div>
                    <h3 id="completedOrders" class="text-3xl font-bold text-gray-800">0</h3>
                    <p class="text-gray-500">طلبات مكتملة</p>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="bg-white rounded-2xl shadow-sm p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">أحدث الطلبات</h3>
                    <button onclick="showSection('orders')" class="text-orange-500 hover:text-orange-600 font-semibold">
                        عرض الكل <i class="fas fa-arrow-left mr-2"></i>
                    </button>
                </div>
                <div id="recentOrdersList" class="space-y-4">
                    <!-- Recent orders will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Orders Section -->
        <section id="ordersSection" class="section p-8 hidden fade-in">
            <div class="bg-white rounded-2xl shadow-sm p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                    <h3 class="text-xl font-bold text-gray-800">جميع الطلبات</h3>
                    <div class="flex flex-wrap gap-4">
                        <select id="statusFilter" onchange="filterOrders()" class="px-4 py-2 border rounded-xl focus:ring-2 focus:ring-orange-500">
                            <option value="all">جميع الحالات</option>
                            <option value="جديد">جديد</option>
                            <option value="قيد_التحضير">قيد التحضير</option>
                            <option value="جاهز">جاهز</option>
                            <option value="تم_التوصيل">تم التوصيل</option>
                            <option value="ملغي">ملغي</option>
                        </select>
                        <input type="text" id="searchOrder" placeholder="بحث بالاسم أو الهاتف..." onkeyup="filterOrders()" class="px-4 py-2 border rounded-xl focus:ring-2 focus:ring-orange-500 w-64">
                    </div>
                </div>
                <div id="ordersTable" class="overflow-x-auto">
                    <!-- Orders table will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Menu Management Section -->
        <section id="menuSection" class="section p-8 hidden fade-in">
            <div class="bg-white rounded-2xl shadow-sm p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800">إدارة قائمة الطعام</h3>
                    <button onclick="showAddItemModal()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded-xl font-semibold transition">
                        <i class="fas fa-plus ml-2"></i>إضافة صنف
                    </button>
                </div>
                <div id="menuItemsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Menu items will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settingsSection" class="section p-8 hidden fade-in">
            <div class="grid gap-6">
                <!-- Change Admin Code -->
                <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6"><i class="fas fa-key text-orange-500 ml-2"></i>تغيير رمز الدخول</h3>
                    <form onsubmit="changeAdminCode(event)" class="max-w-md">
                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">الرمز الحالي</label>
                            <input type="password" id="currentCode" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">الرمز الجديد</label>
                            <input type="password" id="newCode" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-2">تأكيد الرمز الجديد</label>
                            <input type="password" id="confirmCode" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                        </div>
                        <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-xl font-bold transition">
                            <i class="fas fa-save ml-2"></i>حفظ التغييرات
                        </button>
                    </form>
                </div>

                <!-- Restaurant Info -->
                <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-6"><i class="fas fa-store text-orange-500 ml-2"></i>معلومات المطعم</h3>
                    <form onsubmit="saveRestaurantInfo(event)" class="max-w-lg">
                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">اسم المطعم</label>
                            <input type="text" id="restaurantName" value="مطعم الشيف" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 font-semibold mb-2">رقم الهاتف</label>
                            <input type="tel" id="restaurantPhone" value="+966 50 123 4567" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 font-semibold mb-2">العنوان</label>
                            <textarea id="restaurantAddress" rows="2" class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">شارع الملك فهد، الرياض</textarea>
                        </div>
                        <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-3 rounded-xl font-bold transition">
                            <i class="fas fa-save ml-2"></i>حفظ المعلومات
                        </button>
                    </form>
                </div>

                <!-- Danger Zone -->
                <div class="bg-white rounded-2xl shadow-sm p-6 border-2 border-red-200">
                    <h3 class="text-xl font-bold text-red-600 mb-6"><i class="fas fa-exclamation-triangle ml-2"></i>منطقة الخطر</h3>
                    <div class="flex flex-wrap gap-4">
                        <button onclick="clearAllOrders()" class="bg-red-100 hover:bg-red-200 text-red-600 px-6 py-3 rounded-xl font-semibold transition">
                            <i class="fas fa-trash ml-2"></i>حذف جميع الطلبات
                        </button>
                        <button onclick="resetToDefault()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl font-semibold transition">
                            <i class="fas fa-undo ml-2"></i>إعادة ضبط المصنع
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Order Details Modal -->
    <div id="orderModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto fade-in">
            <div class="sticky top-0 bg-white border-b p-6 flex justify-between items-center">
                <h3 class="text-2xl font-bold"><i class="fas fa-receipt text-orange-500 ml-2"></i>تفاصيل الطلب</h3>
                <button onclick="closeOrderModal()" class="text-gray-500 hover:text-gray-700 text-2xl"><i class="fas fa-times"></i></button>
            </div>
            <div id="orderDetails" class="p-6">
                <!-- Order details will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="addItemModal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-md w-full fade-in">
            <div class="border-b p-6 flex justify-between items-center">
                <h3 class="text-xl font-bold"><i class="fas fa-plus-circle text-orange-500 ml-2"></i>إضافة صنف جديد</h3>
                <button onclick="closeAddItemModal()" class="text-gray-500 hover:text-gray-700 text-xl"><i class="fas fa-times"></i></button>
            </div>
            <form onsubmit="addMenuItem(event)" class="p-6">
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">اسم الصنف</label>
                    <input type="text" id="itemName" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">السعر (ر.س)</label>
                    <input type="number" id="itemPrice" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">التصنيف</label>
                    <select id="itemCategory" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                        <option value="burger">برجر</option>
                        <option value="pizza">بيتزا</option>
                        <option value="chicken">دجاج</option>
                        <option value="drinks">مشروبات</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 font-semibold mb-2">رابط الصورة</label>
                    <input type="url" id="itemImage" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500">
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 font-semibold mb-2">الوصف</label>
                    <textarea id="itemDesc" rows="2" required class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500"></textarea>
                </div>
                <button type="submit" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-xl font-bold transition">
                    <i class="fas fa-plus ml-2"></i>إضافة الصنف
                </button>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-8 py-4 rounded-xl shadow-2xl hidden z-50 fade-in">
        <i class="fas fa-check-circle ml-2"></i>
        <span id="toastMessage">تم بنجاح!</span>
    </div>

    <script>
        // Check Auth
        if (localStorage.getItem('adminAuth') !== 'true') {
            window.location.href = 'index.html';
        }

        // Default menu items
        const defaultMenuItems = [
            { id: 1, name: 'برجر كلاسيك', price: 35, category: 'burger', image: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=400', desc: 'برجر لحم مع جبنة وخضروات طازجة' },
            { id: 2, name: 'برجر دجاج', price: 30, category: 'burger', image: 'https://images.unsplash.com/photo-1606755962773-d324e0a13086?w=400', desc: 'برجر دجاج مقرمش مع صلصة خاصة' },
            { id: 3, name: 'برجر مزدوج', price: 50, category: 'burger', image: 'https://images.unsplash.com/photo-1553979459-d2229ba7433b?w=400', desc: 'طبقتان من اللحم مع جبنة مزدوجة' },
            { id: 4, name: 'بيتزا مارجريتا', price: 45, category: 'pizza', image: 'https://images.unsplash.com/photo-1574071318508-1cdbab80d002?w=400', desc: 'صلصة طماطم وجبنة موزاريلا وريحان' },
            { id: 5, name: 'بيتزا بيبروني', price: 55, category: 'pizza', image: 'https://images.unsplash.com/photo-1628840042765-356cda07504e?w=400', desc: 'بيبروني حار مع جبنة إضافية' },
            { id: 6, name: 'بيتزا خضار', price: 40, category: 'pizza', image: 'https://images.unsplash.com/photo-1511689660979-10d2b1aada49?w=400', desc: 'تشكيلة خضروات طازجة' },
            { id: 7, name: 'دجاج مقلي', price: 40, category: 'chicken', image: 'https://images.unsplash.com/photo-1626645738196-c2a7c87a8f58?w=400', desc: '8 قطع دجاج مقرمش' },
            { id: 8, name: 'أجنحة حارة', price: 35, category: 'chicken', image: 'https://images.unsplash.com/photo-1608039829572-9b0189c96a58?w=400', desc: 'أجنحة دجاج بالصلصة الحارة' },
            { id: 9, name: 'شاورما دجاج', price: 25, category: 'chicken', image: 'https://images.unsplash.com/photo-1529006557810-274b9b2fc783?w=400', desc: 'شاورما دجاج مع الثومية' },
            { id: 10, name: 'عصير برتقال', price: 12, category: 'drinks', image: 'https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?w=400', desc: 'عصير برتقال طبيعي طازج' },
            { id: 11, name: 'كولا', price: 8, category: 'drinks', image: 'https://images.unsplash.com/photo-1554866585-cd94860890b7?w=400', desc: 'مشروب غازي بارد' },
            { id: 12, name: 'موهيتو', price: 15, category: 'drinks', image: 'https://images.unsplash.com/photo-1551538827-9c037cb4f32a?w=400', desc: 'موهيتو منعش بالنعناع والليمون' },
        ];

        // Get data
        let menuItems = JSON.parse(localStorage.getItem('menuItems')) || defaultMenuItems;
        let orders = JSON.parse(localStorage.getItem('orders')) || [];

        // Navigation
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + 'Section').classList.remove('hidden');
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-orange-500', 'text-white');
                btn.classList.add('hover:bg-gray-800');
            });
            event.currentTarget.classList.add('bg-orange-500', 'text-white');
            event.currentTarget.classList.remove('hover:bg-gray-800');
            
            // Update page title
            const titles = {
                dashboard: 'لوحة التحكم',
                orders: 'إدارة الطلبات',
                menu: 'قائمة الطعام',
                settings: 'الإعدادات'
            };
            document.getElementById('pageTitle').textContent = titles[section];
            
            // Refresh data
            if (section === 'dashboard') loadDashboard();
            if (section === 'orders') loadOrders();
            if (section === 'menu') loadMenuItems();
        }

        // Dashboard
        function loadDashboard() {
            orders = JSON.parse(localStorage.getItem('orders')) || [];
            
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, o) => o.status !== 'ملغي' ? sum + o.total : sum, 0);
            const pendingOrders = orders.filter(o => o.status === 'جديد' || o.status === 'قيد_التحضير').length;
            const completedOrders = orders.filter(o => o.status === 'تم_التوصيل').length;
            
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('totalRevenue').textContent = totalRevenue + ' ر.س';
            document.getElementById('pendingOrders').textContent = pendingOrders;
            document.getElementById('completedOrders').textContent = completedOrders;
            
            // Recent orders
            const recentOrders = orders.slice(0, 5);
            const recentList = document.getElementById('recentOrdersList');
            
            if (recentOrders.length === 0) {
                recentList.innerHTML = '<p class="text-gray-500 text-center py-8">لا توجد طلبات بعد</p>';
            } else {
                recentList.innerHTML = recentOrders.map(order => `
                    <div class="order-card flex items-center justify-between p-4 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100" onclick="viewOrder(${order.id})">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-receipt text-orange-500"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800">${order.customer.name}</h4>
                                <p class="text-sm text-gray-500">${order.date}</p>
                            </div>
                        </div>
                        <div class="text-left">
                            <p class="font-bold text-orange-500">${order.total} ر.س</p>
                            <span class="status-${order.status.replace(' ', '_')} px-3 py-1 rounded-full text-xs font-semibold">${order.status}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            // Update notification badge
            const newOrders = orders.filter(o => o.status === 'جديد').length;
            const badge = document.getElementById('notifBadge');
            if (newOrders > 0) {
                badge.textContent = newOrders;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // Orders
        function loadOrders() {
            orders = JSON.parse(localStorage.getItem('orders')) || [];
            filterOrders();
        }

        function filterOrders() {
            const status = document.getElementById('statusFilter').value;
            const search = document.getElementById('searchOrder').value.toLowerCase();
            
            let filtered = orders;
            
            if (status !== 'all') {
                filtered = filtered.filter(o => o.status === status);
            }
            
            if (search) {
                filtered = filtered.filter(o => 
                    o.customer.name.toLowerCase().includes(search) || 
                    o.customer.phone.includes(search)
                );
            }
            
            const table = document.getElementById('ordersTable');
            
            if (filtered.length === 0) {
                table.innerHTML = '<p class="text-gray-500 text-center py-12">لا توجد طلبات</p>';
            } else {
                table.innerHTML = `
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="text-right p-4 font-semibold text-gray-600">رقم الطلب</th>
                                <th class="text-right p-4 font-semibold text-gray-600">العميل</th>
                                <th class="text-right p-4 font-semibold text-gray-600">الهاتف</th>
                                <th class="text-right p-4 font-semibold text-gray-600">الإجمالي</th>
                                <th class="text-right p-4 font-semibold text-gray-600">الحالة</th>
                                <th class="text-right p-4 font-semibold text-gray-600">التاريخ</th>
                                <th class="text-center p-4 font-semibold text-gray-600">إجراءات</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            ${filtered.map(order => `
                                <tr class="hover:bg-gray-50">
                                    <td class="p-4 font-bold">#${order.id.toString().slice(-6)}</td>
                                    <td class="p-4">${order.customer.name}</td>
                                    <td class="p-4 text-gray-500">${order.customer.phone}</td>
                                    <td class="p-4 font-bold text-orange-500">${order.total} ر.س</td>
                                    <td class="p-4">
                                        <select onchange="updateOrderStatus(${order.id}, this.value)" class="status-${order.status.replace(' ', '_')} px-3 py-1 rounded-full text-sm font-semibold border-0 cursor-pointer">
                                            <option value="جديد" ${order.status === 'جديد' ? 'selected' : ''}>جديد</option>
                                            <option value="قيد_التحضير" ${order.status === 'قيد_التحضير' ? 'selected' : ''}>قيد التحضير</option>
                                            <option value="جاهز" ${order.status === 'جاهز' ? 'selected' : ''}>جاهز</option>
                                            <option value="تم_التوصيل" ${order.status === 'تم_التوصيل' ? 'selected' : ''}>تم التوصيل</option>
                                            <option value="ملغي" ${order.status === 'ملغي' ? 'selected' : ''}>ملغي</option>
                                        </select>
                                    </td>
                                    <td class="p-4 text-gray-500 text-sm">${order.date}</td>
                                    <td class="p-4 text-center">
                                        <button onclick="viewOrder(${order.id})" class="text-blue-500 hover:text-blue-700 mx-1" title="عرض"><i class="fas fa-eye"></i></button>
                                        <button onclick="deleteOrder(${order.id})" class="text-red-500 hover:text-red-700 mx-1" title="حذف"><i class="fas fa-trash"></i></button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        function updateOrderStatus(orderId, status) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = status;
                localStorage.setItem('orders', JSON.stringify(orders));
                showToast('تم تحديث حالة الطلب');
                loadOrders();
            }
        }

        function viewOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const details = document.getElementById('orderDetails');
            details.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-gray-50 p-4 rounded-xl">
                        <h4 class="font-bold text-gray-800 mb-3"><i class="fas fa-user text-orange-500 ml-2"></i>بيانات العميل</h4>
                        <p class="mb-2"><strong>الاسم:</strong> ${order.customer.name}</p>
                        <p class="mb-2"><strong>الهاتف:</strong> ${order.customer.phone}</p>
                        <p><strong>العنوان:</strong> ${order.customer.address}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-xl">
                        <h4 class="font-bold text-gray-800 mb-3"><i class="fas fa-info-circle text-orange-500 ml-2"></i>معلومات الطلب</h4>
                        <p class="mb-2"><strong>رقم الطلب:</strong> #${order.id.toString().slice(-6)}</p>
                        <p class="mb-2"><strong>التاريخ:</strong> ${order.date}</p>
                        <p><strong>الحالة:</strong> <span class="status-${order.status.replace(' ', '_')} px-3 py-1 rounded-full text-sm font-semibold">${order.status}</span></p>
                    </div>
                </div>
                
                ${order.notes ? `<div class="bg-yellow-50 p-4 rounded-xl mb-6"><h4 class="font-bold text-gray-800 mb-2"><i class="fas fa-sticky-note text-yellow-500 ml-2"></i>ملاحظات</h4><p>${order.notes}</p></div>` : ''}
                
                <div class="border rounded-xl overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="text-right p-3">الصنف</th>
                                <th class="text-center p-3">الكمية</th>
                                <th class="text-center p-3">السعر</th>
                                <th class="text-left p-3">الإجمالي</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${order.items.map(item => `
                                <tr class="border-t">
                                    <td class="p-3">${item.name}</td>
                                    <td class="p-3 text-center">${item.quantity}</td>
                                    <td class="p-3 text-center">${item.price} ر.س</td>
                                    <td class="p-3 text-left font-bold">${item.price * item.quantity} ر.س</td>
                                </tr>
                            `).join('')}
                        </tbody>
                        <tfoot class="bg-orange-50">
                            <tr>
                                <td colspan="3" class="p-4 text-left font-bold text-lg">الإجمالي الكلي</td>
                                <td class="p-4 text-left font-bold text-xl text-orange-500">${order.total} ر.س</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <div class="flex gap-4 mt-6">
                    <button onclick="printOrder(${order.id})" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-xl font-bold transition">
                        <i class="fas fa-print ml-2"></i>طباعة
                    </button>
                    <button onclick="deleteOrder(${order.id}); closeOrderModal();" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-xl font-bold transition">
                        <i class="fas fa-trash ml-2"></i>حذف
                    </button>
                </div>
            `;
            
            document.getElementById('orderModal').classList.remove('hidden');
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.add('hidden');
        }

        function deleteOrder(orderId) {
            if (confirm('هل أنت متأكد من حذف هذا الطلب؟')) {
                orders = orders.filter(o => o.id !== orderId);
                localStorage.setItem('orders', JSON.stringify(orders));
                loadOrders();
                loadDashboard();
                showToast('تم حذف الطلب');
            }
        }

        function printOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>طلب #${order.id.toString().slice(-6)}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 10px; text-align: right; }
                        th { background: #f5f5f5; }
                        .total { font-size: 1.2em; font-weight: bold; }
                    </style>
                </head>
                <body>
                    <h1>مطعم الشيف - فاتورة</h1>
                    <p><strong>رقم الطلب:</strong> #${order.id.toString().slice(-6)}</p>
                    <p><strong>التاريخ:</strong> ${order.date}</p>
                    <hr>
                    <p><strong>العميل:</strong> ${order.customer.name}</p>
                    <p><strong>الهاتف:</strong> ${order.customer.phone}</p>
                    <p><strong>العنوان:</strong> ${order.customer.address}</p>
                    <table>
                        <tr><th>الصنف</th><th>الكمية</th><th>السعر</th><th>الإجمالي</th></tr>
                        ${order.items.map(i => `<tr><td>${i.name}</td><td>${i.quantity}</td><td>${i.price} ر.س</td><td>${i.price * i.quantity} ر.س</td></tr>`).join('')}
                    </table>
                    <p class="total">الإجمالي: ${order.total} ر.س</p>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Menu Management
        function loadMenuItems() {
            menuItems = JSON.parse(localStorage.getItem('menuItems')) || defaultMenuItems;
            const list = document.getElementById('menuItemsList');
            
            list.innerHTML = menuItems.map(item => `
                <div class="bg-gray-50 rounded-xl overflow-hidden">
                    <img src="${item.image}" alt="${item.name}" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-gray-800">${item.name}</h4>
                            <span class="bg-orange-500 text-white px-2 py-1 rounded text-sm">${item.price} ر.س</span>
                        </div>
                        <p class="text-gray-500 text-sm mb-3">${item.desc}</p>
                        <div class="flex gap-2">
                            <button onclick="deleteMenuItem(${item.id})" class="flex-1 bg-red-100 hover:bg-red-200 text-red-600 py-2 rounded-lg transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showAddItemModal() {
            document.getElementById('addItemModal').classList.remove('hidden');
        }

        function closeAddItemModal() {
            document.getElementById('addItemModal').classList.add('hidden');
        }

        function addMenuItem(e) {
            e.preventDefault();
            
            const newItem = {
                id: Date.now(),
                name: document.getElementById('itemName').value,
                price: parseInt(document.getElementById('itemPrice').value),
                category: document.getElementById('itemCategory').value,
                image: document.getElementById('itemImage').value,
                desc: document.getElementById('itemDesc').value
            };
            
            menuItems.push(newItem);
            localStorage.setItem('menuItems', JSON.stringify(menuItems));
            
            closeAddItemModal();
            loadMenuItems();
            showToast('تمت إضافة الصنف بنجاح');
            
            // Reset form
            e.target.reset();
        }

        function deleteMenuItem(id) {
            if (confirm('هل أنت متأكد من حذف هذا الصنف؟')) {
                menuItems = menuItems.filter(i => i.id !== id);
                localStorage.setItem('menuItems', JSON.stringify(menuItems));
                loadMenuItems();
                showToast('تم حذف الصنف');
            }
        }

        // Settings
        function changeAdminCode(e) {
            e.preventDefault();
            
            const current = document.getElementById('currentCode').value;
            const newCode = document.getElementById('newCode').value;
            const confirm = document.getElementById('confirmCode').value;
            const savedCode = localStorage.getItem('adminCode') || '1234';
            
            if (current !== savedCode) {
                showToast('الرمز الحالي غير صحيح!');
                return;
            }
            
            if (newCode !== confirm) {
                showToast('الرمز الجديد غير متطابق!');
                return;
            }
            
            localStorage.setItem('adminCode', newCode);
            showToast('تم تغيير رمز الدخول بنجاح');
            e.target.reset();
        }

        function saveRestaurantInfo(e) {
            e.preventDefault();
            
            const info = {
                name: document.getElementById('restaurantName').value,
                phone: document.getElementById('restaurantPhone').value,
                address: document.getElementById('restaurantAddress').value
            };
            
            localStorage.setItem('restaurantInfo', JSON.stringify(info));
            showToast('تم حفظ المعلومات بنجاح');
        }

        function clearAllOrders() {
            if (confirm('هل أنت متأكد من حذف جميع الطلبات؟ لا يمكن التراجع عن هذا الإجراء.')) {
                localStorage.removeItem('orders');
                orders = [];
                loadDashboard();
                showToast('تم حذف جميع الطلبات');
            }
        }

        function resetToDefault() {
            if (confirm('هل أنت متأكد من إعادة ضبط جميع الإعدادات؟ سيتم حذف جميع البيانات.')) {
                localStorage.clear();
                localStorage.setItem('adminAuth', 'true');
                showToast('تم إعادة ضبط المصنع');
                setTimeout(() => location.reload(), 1000);
            }
        }

        // Notifications
        function toggleNotifications() {
            document.getElementById('notifDropdown').classList.toggle('hidden');
            loadNotifications();
        }

        function loadNotifications() {
            const newOrders = orders.filter(o => o.status === 'جديد');
            const list = document.getElementById('notifList');
            
            if (newOrders.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center p-4">لا توجد إشعارات</p>';
            } else {
                list.innerHTML = newOrders.map(order => `
                    <div onclick="viewOrder(${order.id}); toggleNotifications();" class="p-4 border-b hover:bg-gray-50 cursor-pointer">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-bell text-orange-500"></i>
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">طلب جديد من ${order.customer.name}</p>
                                <p class="text-sm text-gray-500">${order.total} ر.س - ${order.date}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // Logout
        function logout() {
            localStorage.removeItem('adminAuth');
            window.location.href = 'index.html';
        }

        // Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
            
            // Load saved restaurant info
            const info = JSON.parse(localStorage.getItem('restaurantInfo'));
            if (info) {
                document.getElementById('restaurantName').value = info.name || '';
                document.getElementById('restaurantPhone').value = info.phone || '';
                document.getElementById('restaurantAddress').value = info.address || '';
            }
        });

        // Close dropdowns on outside click
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#notifDropdown') && !e.target.closest('[onclick="toggleNotifications()"]')) {
                document.getElementById('notifDropdown').classList.add('hidden');
            }
        });
    </script>
</body>
</html>
